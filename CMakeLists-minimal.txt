cmake_minimum_required(VERSION 3.16...3.26)

# Set project name for minimal test plugin
project(obs-stabilizer-minimal VERSION 0.1.0)
add_library(${CMAKE_PROJECT_NAME} MODULE)

# === Verification ===
message(STATUS "Project name: ${CMAKE_PROJECT_NAME}")
message(STATUS "Build type: ${CMAKE_BUILD_TYPE}")

# Configure target properties
set_target_properties(
  ${CMAKE_PROJECT_NAME}
  PROPERTIES AUTOMOC ON
             AUTOUIC ON
             AUTORCC ON)

# Find OBS Studio development package
find_package(libobs REQUIRED)

# Set target sources - MINIMAL VERSION (no OpenCV, no stabilizer)
target_sources(${CMAKE_PROJECT_NAME} PRIVATE src/minimal_plugin_main.cpp)

# Link libraries - MINIMAL DEPENDENCIES ONLY
target_link_libraries(${CMAKE_PROJECT_NAME} OBS::libobs)

# Set plugin properties for macOS
if(OS_MACOS)
  set_target_properties(${CMAKE_PROJECT_NAME} PROPERTIES
    BUNDLE TRUE
    BUNDLE_EXTENSION "plugin"
    OUTPUT_NAME ${CMAKE_PROJECT_NAME}
    MACOSX_BUNDLE_INFO_PLIST "${CMAKE_CURRENT_SOURCE_DIR}/Info-minimal.plist.in"
  )
endif()

# Installation
if(OS_MACOS)
  install(TARGETS ${CMAKE_PROJECT_NAME}
    BUNDLE DESTINATION "$ENV{HOME}/Library/Application Support/obs-studio/plugins/"
    COMPONENT Runtime)
endif()