/*
Plugin Name
Copyright (C) <Year> <Developer> <Email Address>

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License along
with this program. If not, see <https://www.gnu.org/licenses/>
*/

#include <plugin-support.h>

const char *PLUGIN_NAME = "@CMAKE_PROJECT_NAME@";
const char *PLUGIN_VERSION = "@CMAKE_PROJECT_VERSION@";

void obs_log(int log_level, const char *format, ...)
{
	if (!PLUGIN_NAME || !format) return;
	
	// Conservative buffer size estimation with safety margin
	size_t base_len = strlen(PLUGIN_NAME) + strlen(format) + 10; // "[" + "] " + null terminator + margin
	size_t buffer_size = base_len + 256; // Extra space for format expansion
	
	char *template = malloc(buffer_size);
	if (!template) return; // Handle allocation failure
	
	int ret = snprintf(template, buffer_size, "[%s] %s", PLUGIN_NAME, format);
	if (ret < 0 || ret >= (int)buffer_size) {
		free(template);
		return; // Handle formatting error
	}
	
	va_list args;
	va_start(args, format);
	blogva(log_level, template, args);
	va_end(args);
	
	free(template);
}
